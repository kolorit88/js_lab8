<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–§–∞–∫—Ç—ã –æ –∂–∏–≤–æ—Ç–Ω—ã—Ö</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      background-color: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
    }
    .welcome-message {
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    .username {
      font-weight: bold;
      color: #e74c3c;
      font-style: italic;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    .animal-options {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .animal-option {
      margin: 10px;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      width: 120px;
    }
    .animal-option:hover {
      border-color: #3498db;
      transform: scale(1.05);
    }
    .animal-option.selected {
      border-color: #2ecc71;
      background-color: #e8f8f0;
    }
    .animal-image {
      max-width: 100%;
      height: auto;
      max-height: 400px;
      border-radius: 8px;
      margin: 20px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .fact-container {
      margin: 20px 0;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
      text-align: left;
    }
    .hidden {
      display: none;
    }
    .loading {
      font-style: italic;
      color: #7f8c8d;
    }
    .language-toggle {
      margin: 20px 0;
    }
  </style>
</head>
<body>
<div class="container">
  <div id="welcome-step">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, —Å—Ç—Ä–∞–Ω–Ω–∏–∫!</h1>
    <div class="welcome-message">
      –Ø –±—É–¥—É –∑–≤–∞—Ç—å —Ç–µ–±—è <span id="username" class="username">...</span>, –æ–∫?
    </div>
    <div>
      <button id="accept-name">–î–∞, –æ—Ç–ª–∏—á–Ω–æ!</button>
      <button id="change-name">–ù–µ—Ç, –¥–∞–≤–∞–π –¥—Ä—É–≥–æ–µ</button>
    </div>
    <div id="name-loading" class="loading hidden">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ –∏–º—è...</div>
  </div>

  <div id="animal-step" class="hidden">
    <h1>–ù–∞ —á—å–µ–π —Ç—ã —Å—Ç–æ—Ä–æ–Ω–µ?</h1>
    <div class="animal-options">
      <div class="animal-option" data-animal="cat">
        <div>üê±</div>
        <div>–ö–æ—à–∫–∏</div>
      </div>
      <div class="animal-option" data-animal="dog">
        <div>üê∂</div>
        <div>–°–æ–±–∞–∫–∏</div>
      </div>
      <div class="animal-option" data-animal="fox">
        <div>ü¶ä</div>
        <div>–õ–∏—Å—ã</div>
      </div>
    </div>
    <button id="select-animal" disabled>–ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–∫—Ç</button>
  </div>


  <div id="fact-step" class="hidden">
    <h1 id="animal-title"></h1>
    <img id="animal-image" class="animal-image" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ">
    <div class="fact-container">
      <h3>–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:</h3>
      <p id="animal-fact"></p>
    </div>
    <div class="language-toggle">
      <button id="translate-btn">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π</button>
      <span id="translation-loading" class="loading hidden">–ü–µ—Ä–µ–≤–æ–∂—É...</span>
    </div>
    <button id="new-fact">–ï—â—ë —Ñ–∞–∫—Ç</button>
    <button id="change-animal">–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ</button>
  </div>
</div>

<script>
  const welcomeStep = document.getElementById('welcome-step');
  const animalStep = document.getElementById('animal-step');
  const factStep = document.getElementById('fact-step');
  const usernameElement = document.getElementById('username');
  const acceptNameBtn = document.getElementById('accept-name');
  const changeNameBtn = document.getElementById('change-name');
  const nameLoading = document.getElementById('name-loading');
  const animalOptions = document.querySelectorAll('.animal-option');
  const selectAnimalBtn = document.getElementById('select-animal');
  const animalTitle = document.getElementById('animal-title');
  const animalImage = document.getElementById('animal-image');
  const animalFact = document.getElementById('animal-fact');
  const newFactBtn = document.getElementById('new-fact');
  const changeAnimalBtn = document.getElementById('change-animal');
  const translateBtn = document.getElementById('translate-btn');
  const translationLoading = document.getElementById('translation-loading');

  const animalImages = {
    cat: 'images/cat.png',
    dog: 'images/dog.jpg',
    fox: 'images/fox.jpg'
  };

  const animalFactsAPI = {
    cat: 'https://some-random-api.ml/facts/cat',
    dog: 'https://some-random-api.ml/facts/dog',
    fox: 'https://some-random-api.ml/facts/fox'
  };

  let currentUsername = '';
  let selectedAnimal = '';
  let currentFact = '';
  let currentFactRu = '';

  generateRandomName();

  acceptNameBtn.addEventListener('click', () => {
    welcomeStep.classList.add('hidden');
    animalStep.classList.remove('hidden');
  });

  changeNameBtn.addEventListener('click', generateRandomName);

  animalOptions.forEach(option => {
    option.addEventListener('click', () => {
      animalOptions.forEach(opt => opt.classList.remove('selected'));
      option.classList.add('selected');
      selectedAnimal = option.dataset.animal;
      selectAnimalBtn.disabled = false;
    });
  });

  selectAnimalBtn.addEventListener('click', () => {
    animalStep.classList.add('hidden');
    factStep.classList.remove('hidden');
    getAnimalFact();
  });

  newFactBtn.addEventListener('click', getAnimalFact);
  changeAnimalBtn.addEventListener('click', () => {
    factStep.classList.add('hidden');
    animalStep.classList.remove('hidden');
  });

  translateBtn.addEventListener('click', translateFact);


  async function generateRandomName() {
    nameLoading.classList.remove('hidden');
    changeNameBtn.disabled = true;

    try {

      const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
      const apiUrl = 'https://random-data-api.com/api/v2/users';

      const response = await fetch(proxyUrl + apiUrl);
      const data = await response.json();


      currentUsername = `${data.first_name} ${data.last_name}`;
      usernameElement.textContent = currentUsername;
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–º–µ–Ω–∏:', error);

      const fallbackNames = ['Toilet Mail', 'Puppy Solar', 'Space Cat', 'Moon Dog', 'Star Fox'];
      currentUsername = fallbackNames[Math.floor(Math.random() * fallbackNames.length)];
      usernameElement.textContent = currentUsername;
    }

    nameLoading.classList.add('hidden');
    changeNameBtn.disabled = false;
  }

  async function getAnimalFact() {
    switch(selectedAnimal) {
      case 'cat':
        animalTitle.textContent = '–§–∞–∫—Ç—ã –æ –∫–æ—à–∫–∞—Ö';
        break;
      case 'dog':
        animalTitle.textContent = '–§–∞–∫—Ç—ã –æ —Å–æ–±–∞–∫–∞—Ö';
        break;
      case 'fox':
        animalTitle.textContent = '–§–∞–∫—Ç—ã –æ –ª–∏—Å–∞—Ö';
        break;
      default:
        console.error('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –∂–∏–≤–æ—Ç–Ω–æ–≥–æ:', selectedAnimal);
        animalFact.textContent = '–û—à–∏–±–∫–∞: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –∂–∏–≤–æ—Ç–Ω–æ–≥–æ';
        return;
    }

    animalImage.src = animalImages[selectedAnimal];
    animalImage.alt = selectedAnimal === 'cat' ? '–ö–æ—à–∫–∞' : selectedAnimal === 'dog' ? '–°–æ–±–∞–∫–∞' : '–õ–∏—Å–∞';

    try {
      const response = await fetch(animalFactsAPI[selectedAnimal]);
      if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–∫—Ç–∞');
      const data = await response.json();
      currentFact = data.fact || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–∫—Ç';
      animalFact.textContent = currentFact;
      currentFactRu = '';

      if (translateBtn) {
        translateBtn.disabled = false;
        translateBtn.textContent = '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π';
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–∞–∫—Ç–∞:', error);
      animalFact.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–∫—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
      if (translateBtn) translateBtn.disabled = true;
    }
  }

  async function translateFact() {
    if (!currentFact) return;
    if (currentFactRu) {
      animalFact.textContent = currentFactRu;
      return;
    }

    translateBtn.disabled = true;
    translationLoading.classList.remove('hidden');

    try {
      const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
      const apiUrl = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(currentFact)}&langpair=en|ru`;

      const response = await fetch(proxyUrl + apiUrl);
      const data = await response.json();

      if (data.responseData && data.responseData.translatedText) {
        currentFactRu = data.responseData.translatedText;
        animalFact.textContent = currentFactRu;
      } else {
        throw new Error('–ü–µ—Ä–µ–≤–æ–¥ –Ω–µ –ø–æ–ª—É—á–µ–Ω');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ:', error);
      animalFact.textContent = currentFact + '\n\n(–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–≤–µ—Å—Ç–∏)';
    }

    translationLoading.classList.add('hidden');
    translateBtn.disabled = false;
  }
</script>
</body>
</html>
